# Файловые системы
1. Узнайте о sparse (разряженных) файлах.
    <br/>
    `Разреженные` – это специальные файлы, которые с большей эффективностью используют файловую систему, они не позволяют ФС занимать свободное дисковое пространство носителя, когда разделы не заполнены. То есть, «пустое место» будет задействовано только при необходимости. Пустая информация в виде нулей, будет хранится в блоке метаданных ФС. Поэтому, разреженные файлы изначально занимают меньший объем носителя, чем их реальный объем.
    <br/>
    Преимущества и недостатки:
    <br/>
    * Самым большим преимуществом разреженных файлов является то, что пользователь может создавать файлы большого размера, которые занимают очень мало места для хранения. Пространство для хранения выделяется автоматически по мере записи на него данных. Разреженные файлы большого объема создаются за относительно короткое время, поскольку файловой системе не требуется предварительно выделять дисковое пространство для записи нулей.
    * Из недостатков — это то, что нельзя скопировать или создать такой файл, если его номинальный размер превышает доступный объем свободного пространства (или ограничения размера квоты, налагаемые на учетные записи пользователей). Например, если исходный размер (со всеми нулевыми байтами) составляет 500 МБ, а для учетной записи пользователя, используемой для его создания, существует предел квоты в 400 МБ. Это приведет к ошибке даже если фактическое дисковое пространство, занимаемое им, составляет всего 50 МБ на диске.
    <br/>
2. Могут ли файлы, являющиеся жесткой ссылкой на один объект, иметь разные права доступа и владельца? Почему?
    <br/>
    Нет, не могут, т.к. это просто ссылки на один и тот же inode - в нём и хранятся права доступа и имя владельца.
3. Сделайте `vagrant destroy` на имеющийся инстанс Ubuntu. Замените содержимое Vagrantfile следующим:
    <br/>
    ```bash
    path_to_disk_folder = './disks'

    host_params = {
        'disk_size' => 2560,
        'disks'=>[1, 2],
        'cpus'=>2,
        'memory'=>2048,
        'hostname'=>'sysadm-fs',
        'vm_name'=>'sysadm-fs'
    }
    Vagrant.configure("2") do |config|
        config.vm.box = "bento/ubuntu-20.04"
        config.vm.hostname=host_params['hostname']
        config.vm.provider :virtualbox do |v|

            v.name=host_params['vm_name']
            v.cpus=host_params['cpus']
            v.memory=host_params['memory']

            host_params['disks'].each do |disk|
                file_to_disk=path_to_disk_folder+'/disk'+disk.to_s+'.vdi'
                unless File.exist?(file_to_disk)
                    v.customize ['createmedium', '--filename', file_to_disk, '--size', host_params['disk_size']]
                end
                v.customize ['storageattach', :id, '--storagectl', 'SATA Controller', '--port', disk.to_s, '--device', 0, '--type', 'hdd', '--medium', file_to_disk]
            end
        end
        config.vm.network "private_network", type: "dhcp"
    end
    ```
    <br/>
    Данная конфигурация создает новую виртуальную машину с двуимя дополнительными неразмеченными дисками по 2,5 Гб
    <br/>
    ![3](/flesystem/3.png)
    <br/>
4. Используя `fdisk`, разбейте первый диск на два раздела: 2 Гб и оставшееся пространство.
    <br/>
    ![4](/flesystem/4.png)
    <br/>
5. Используя `sfdisk`, перенесите эту таблицу разделов на второй диск.
    <br/>
    ![5](/flesystem/5.png)
    <br/>
6. Соберите `mdadm RAID1` на паре разделов 2 Гб.
    <br/>
    ![6](/flesystem/6.png)
    <br/>
7. Соберите `mdadm RAID0` на второй паре маленьких разделов.
    <br/>
    ![7](/flesystem/7.png)
    <br/>
8. Создайте два независимых `PV` на получившихся md-устройствах..
    <br/>
    ![8](/flesystem/8.png)
    <br/>
9. Создайте общую `volume-group` на этих двух `PV`.
    <br/>
    ![9.1](/flesystem/9.1.png)
    <br/>
    ![9.2](/flesystem/9.2.png)
10. Создайте `LV` размером 100 Мб, указав его расположение на `PV` с `RAID0`.
    <br/>
    ![10](/flesystem/10.png)
    <br/>
11. Создайте `mkfs.ext4` ФС на получившемся LV.
    <br/>
    ![11](/flesystem/11.png)
    <br/>
12. Смонтируйте этот раздел в любую директорию, например, `/tmp/new`.
    <br/>
    ![12](/flesystem/12.png)
    <br/>
13. Поместите туда тестовый файл, например, `wget https://mirror.yandex.ru/ubuntu/ls-lR.gz -O /tmp/new/test.gz`.
    <br/>
    ![13](/flesystem/13.png)
    <br/>
14. Прикрепите вывод `lsblk`.
    <br/>
    ![14](/flesystem/14.png)
    <br/>
15. Протестируйте целостность файла:
    <br/>
    ![15](/flesystem/15.png)
    <br/>
16. Используя pvmove, переместите содержимое `PV` с `RAID0` на `RAID1`.
    <br/>
    ![16](/flesystem/16.png)
    <br/>
17. Сделайте `--fail` на устройство в вашем `RAID1 md`.
    <br/>
    ![17](/flesystem/17.png)
    <br/>
18. Подтвердите выводом `dmesg`, что `RAID1` работает в деградированном состоянии.
    <br/>
    ![18](/flesystem/18.png)
    <br/>
19. Протестируйте целостность файла — он должен быть доступен несмотря на «сбойный» диск:
    <br/>
    ![19](/flesystem/19.png)
    <br/>
20. Погасите тестовый хост — `vagrant destroy`.
    ![20](/flesystem/20.png)